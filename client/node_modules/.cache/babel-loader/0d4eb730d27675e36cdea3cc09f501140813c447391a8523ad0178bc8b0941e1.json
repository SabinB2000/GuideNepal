{"ast":null,"code":"// src/pages/ForgotPassword.js\nimport React,{useState}from\"react\";import{useNavigate,Link}from\"react-router-dom\";import{useAuth}from\"../contexts/AuthContext\";import axios from\"axios\";import Swal from\"sweetalert2\";import{motion}from\"framer-motion\";import\"../styles/ForgotPassword.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ForgotPassword(_ref){let{hideLoginLink=false}=_ref;const{user,logout}=useAuth();const navigate=useNavigate();const API=process.env.REACT_APP_API_URL||\"http://localhost:5000/api\";// for public mode\nconst[email,setEmail]=useState(\"\");// for both\nconst[otp,setOtp]=useState(\"\");const[password,setPassword]=useState(\"\");const[confirm,setConfirm]=useState(\"\");const[step,setStep]=useState(\"request\");// or \"reset\"\nconst[loading,setLoading]=useState(false);// email to actually use:\nconst emailToUse=hideLoginLink?user===null||user===void 0?void 0:user.email:email;const validEmail=e=>/^\\S+@\\S+\\.\\S+$/.test(e);const validPassword=p=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[\\W_]).{8,}$/.test(p);const sendOtp=async()=>{// public mode: validate typed email\nif(!hideLoginLink&&!validEmail(email)){return Swal.fire(\"Error\",\"Enter a valid email\",\"error\");}setLoading(true);try{await axios.post(\"\".concat(API,\"/auth/forgot-password/request\"),{email:emailToUse});Swal.fire(\"Sent\",\"Check your inbox for a reset code\",\"success\");setStep(\"reset\");}catch(err){var _err$response,_err$response$data;Swal.fire(\"Error\",((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message,\"error\");}finally{setLoading(false);}};const resetPassword=async e=>{e.preventDefault();if(!otp)return Swal.fire(\"Error\",\"Enter the code\",\"error\");if(!validPassword(password))return Swal.fire(\"Weak password\",\"Use ≥8 chars, upper+lower+digit+symbol\",\"error\");if(password!==confirm)return Swal.fire(\"Error\",\"Passwords must match\",\"error\");setLoading(true);try{await axios.post(\"\".concat(API,\"/auth/forgot-password/reset\"),{email:emailToUse,otp,password});Swal.fire(\"Success\",\"Your password was changed\",\"success\");// if coming from profile, log them out so sidebar disappears\nif(hideLoginLink)logout();// redirect to login (or home if you don't have /login)\nnavigate(\"/login\");}catch(err){var _err$response2,_err$response2$data;Swal.fire(\"Error\",((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||err.message,\"error\");}finally{setLoading(false);}};return/*#__PURE__*/_jsx(motion.div,{className:\"forgot-container\",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:step===\"request\"?/*#__PURE__*/_jsxs(\"div\",{className:\"forgot-box\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Forgot Password\"}),/*#__PURE__*/_jsx(\"p\",{children:hideLoginLink?\"We\\u2019ll send a reset code to \".concat(emailToUse):\"Enter your account email to receive a reset code.\"}),!hideLoginLink&&/*#__PURE__*/_jsx(\"input\",{type:\"email\",placeholder:\"Email address\",value:email,onChange:e=>setEmail(e.target.value),required:true}),/*#__PURE__*/_jsx(motion.button,{className:\"btn\",onClick:sendOtp,disabled:loading,whileTap:{scale:0.95},children:loading?\"Sending…\":\"Send Reset Code\"}),!hideLoginLink&&/*#__PURE__*/_jsxs(\"p\",{className:\"remembered-line\",children:[\"Remembered? \",/*#__PURE__*/_jsx(Link,{to:\"/login\",children:\"Log in\"})]})]}):/*#__PURE__*/_jsxs(\"form\",{className:\"forgot-box\",onSubmit:resetPassword,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Reset Password\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"We sent a code to \",/*#__PURE__*/_jsx(\"strong\",{children:emailToUse})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Verification code\",value:otp,onChange:e=>setOtp(e.target.value),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"New password\",value:password,onChange:e=>setPassword(e.target.value),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Confirm new password\",value:confirm,onChange:e=>setConfirm(e.target.value),required:true}),/*#__PURE__*/_jsx(motion.button,{type:\"submit\",className:\"btn\",disabled:loading,whileTap:{scale:0.95},children:loading?\"Updating…\":\"Update Password\"})]})});}","map":{"version":3,"names":["React","useState","useNavigate","Link","useAuth","axios","Swal","motion","jsx","_jsx","jsxs","_jsxs","ForgotPassword","_ref","hideLoginLink","user","logout","navigate","API","process","env","REACT_APP_API_URL","email","setEmail","otp","setOtp","password","setPassword","confirm","setConfirm","step","setStep","loading","setLoading","emailToUse","validEmail","e","test","validPassword","p","sendOtp","fire","post","concat","err","_err$response","_err$response$data","response","data","message","resetPassword","preventDefault","_err$response2","_err$response2$data","div","className","initial","opacity","y","animate","children","type","placeholder","value","onChange","target","required","button","onClick","disabled","whileTap","scale","to","onSubmit"],"sources":["C:/Users/sabin/OneDrive/Desktop/GUIDE NEAPL/GuideNepal/client/src/pages/ForgotPassword.js"],"sourcesContent":["// src/pages/ForgotPassword.js\r\nimport React, { useState } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport axios from \"axios\";\r\nimport Swal from \"sweetalert2\";\r\nimport { motion } from \"framer-motion\";\r\nimport \"../styles/ForgotPassword.css\";\r\n\r\nexport default function ForgotPassword({ hideLoginLink = false }) {\r\n  const { user, logout } = useAuth();\r\n  const navigate = useNavigate();\r\n  const API = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\r\n\r\n  // for public mode\r\n  const [email, setEmail] = useState(\"\");\r\n  // for both\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirm, setConfirm] = useState(\"\");\r\n  const [step, setStep] = useState(\"request\"); // or \"reset\"\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // email to actually use:\r\n  const emailToUse = hideLoginLink ? user?.email : email;\r\n\r\n  const validEmail = (e) => /^\\S+@\\S+\\.\\S+$/.test(e);\r\n  const validPassword = (p) =>\r\n    /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[\\W_]).{8,}$/.test(p);\r\n\r\n  const sendOtp = async () => {\r\n    // public mode: validate typed email\r\n    if (!hideLoginLink && !validEmail(email)) {\r\n      return Swal.fire(\"Error\", \"Enter a valid email\", \"error\");\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      await axios.post(`${API}/auth/forgot-password/request`, {\r\n        email: emailToUse,\r\n      });\r\n      Swal.fire(\"Sent\", \"Check your inbox for a reset code\", \"success\");\r\n      setStep(\"reset\");\r\n    } catch (err) {\r\n      Swal.fire(\"Error\", err.response?.data?.message || err.message, \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const resetPassword = async (e) => {\r\n    e.preventDefault();\r\n    if (!otp) return Swal.fire(\"Error\", \"Enter the code\", \"error\");\r\n    if (!validPassword(password))\r\n      return Swal.fire(\r\n        \"Weak password\",\r\n        \"Use ≥8 chars, upper+lower+digit+symbol\",\r\n        \"error\"\r\n      );\r\n    if (password !== confirm)\r\n      return Swal.fire(\"Error\", \"Passwords must match\", \"error\");\r\n\r\n    setLoading(true);\r\n    try {\r\n      await axios.post(`${API}/auth/forgot-password/reset`, {\r\n        email: emailToUse,\r\n        otp,\r\n        password,\r\n      });\r\n      Swal.fire(\"Success\", \"Your password was changed\", \"success\");\r\n      // if coming from profile, log them out so sidebar disappears\r\n      if (hideLoginLink) logout();\r\n      // redirect to login (or home if you don't have /login)\r\n      navigate(\"/login\");\r\n    } catch (err) {\r\n      Swal.fire(\"Error\", err.response?.data?.message || err.message, \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"forgot-container\"\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n    >\r\n      {step === \"request\" ? (\r\n        <div className=\"forgot-box\">\r\n          <h2>Forgot Password</h2>\r\n          <p>\r\n            {hideLoginLink\r\n              ? `We’ll send a reset code to ${emailToUse}`\r\n              : \"Enter your account email to receive a reset code.\"}\r\n          </p>\r\n\r\n          {!hideLoginLink && (\r\n            <input\r\n              type=\"email\"\r\n              placeholder=\"Email address\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              required\r\n            />\r\n          )}\r\n\r\n          <motion.button\r\n            className=\"btn\"\r\n            onClick={sendOtp}\r\n            disabled={loading}\r\n            whileTap={{ scale: 0.95 }}\r\n          >\r\n            {loading ? \"Sending…\" : \"Send Reset Code\"}\r\n          </motion.button>\r\n\r\n          {!hideLoginLink && (\r\n            <p className=\"remembered-line\">\r\n              Remembered? <Link to=\"/login\">Log in</Link>\r\n            </p>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <form className=\"forgot-box\" onSubmit={resetPassword}>\r\n          <h2>Reset Password</h2>\r\n          <p>\r\n            We sent a code to <strong>{emailToUse}</strong>\r\n          </p>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Verification code\"\r\n            value={otp}\r\n            onChange={(e) => setOtp(e.target.value)}\r\n            required\r\n          />\r\n          <input\r\n            type=\"password\"\r\n            placeholder=\"New password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            required\r\n          />\r\n          <input\r\n            type=\"password\"\r\n            placeholder=\"Confirm new password\"\r\n            value={confirm}\r\n            onChange={(e) => setConfirm(e.target.value)}\r\n            required\r\n          />\r\n          <motion.button\r\n            type=\"submit\"\r\n            className=\"btn\"\r\n            disabled={loading}\r\n            whileTap={{ scale: 0.95 }}\r\n          >\r\n            {loading ? \"Updating…\" : \"Update Password\"}\r\n          </motion.button>\r\n        </form>\r\n      )}\r\n    </motion.div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}